## 操作系统 (2018.2.4)
1. `进程间通信方式 --- 8种`
```
1 无名管道通信
无名管道( pipe )：管道是一种半双工的通信方式，数据只能单向流动，而且只能在具有亲缘关系的进程间使用。进程的亲缘关系通常是指父子进程关系。

2 高级管道通信
高级管道(popen)：将另一个程序当做一个新的进程在当前程序进程中启动，则它算是当前程序的子进程，这种方式我们成为高级管道方式。

3 有名管道通信
有名管道 (named pipe) ： 有名管道也是半双工的通信方式，但是它允许无亲缘关系进程间的通信。

4 消息队列通信
消息队列( message queue ) ： 消息队列是由消息的链表，存放在内核中并由消息队列标识符标识。消息队列克服了信号传递信息少、管道只能承载无格式字节流以及缓冲区大小受限等缺点。

5 信号量通信
信号量( semophore ) ： 信号量是一个计数器，可以用来控制多个进程对共享资源的访问。它常作为一种锁机制，防止某进程正在访问共享资源时，其他进程也访问该资源。因此，主要作为进程间以及同一进程内不同线程之间的同步手段。

6 信号
信号 ( sinal ) ： 信号是一种比较复杂的通信方式，用于通知接收进程某个事件已经发生。

7 共享内存通信
共享内存( shared memory ) ：共享内存就是映射一段能被其他进程所访问的内存，这段共享内存由一个进程创建，但多个进程都可以访问。共享内存是最快的 IPC 方式，它是针对其他进程间通信方式运行效率低而专门设计的。它往往与其他通信机制，如信号两，配合使用，来实现进程间的同步和通信。

8 套接字通信
套接字( socket ) ： 套接口也是一种进程间通信机制，与其他通信机制不同的是，它可用于不同机器间的进程通信
```
2. `PV操作和信号量`
* [PV操作和信号量](https://www.cnblogs.com/nzbbody/p/4219957.html)
```
* 对于信号量，可以认为是一个仓库，有两个概念，容量和当前的货物个数。

* P操作从仓库拿货，如果仓库中没有货，线程一直等待，直到V操作，往仓库里添加了货物，为了避免P操作一直   等待下去，会有一个超时时间。

* V操作往仓库送货，如果仓库满了，线程等待，直到有P操作，从仓库中拿走货物，有空的位置。

* 创建信号量，设置容量，先有V操作，才能P操作。

* P操作：货物个数减1，减过之后，货物个数大于等于0，说明已经拿到货物，线程继续。否者线程阻塞。

* V操作：货物个数加1，加过之后，货物个数小于等于容量，说明添加成功，线程继续。否者线程阻塞。

* 信号量：0≤ 信号量≤容量 ，取值 表示当前可以使用的货物；
　　     信号量<0 ，  取值 表示当前等待使用货物的线程；
        信号量>容量 ，  信号量-容量 表示当前等待添加货物的线程。

* 通常，信号量的容量设置很大，可以一直V操作，不会阻塞，但是P操作的时候，很可能阻塞。

* 当容量为1，也就是互斥，执行流程必定是V操作，P操作，V操作，P操作...

* 信号量如何做到线程同步？
可以认为信号量关联一组线程，保存一个指针，指向线程数组的首地址。比如当前信号量为-1，进行P操作，信号量为-2，说明没有拿到货物，线程等待，取值为-2，说明有两个线程等待那货物。这个时候，其他线程进行V操作，信号量加1，为-1，信号量通知等待的线程中，第一个线程继续执行，第二个线程继续等待。

也就是说，P操作等待的情况是减1后，信号量小于0。 P操作继续执行的情况有两种：a、减1后，信号量大于等于0，不需等待，直接执行；b、信号量小于0，等待中，其他人进行了V操作，通知这个线程，继续执行。

* 项目中的使用场景：
客户端使用提供的SDk与服务交互，为了提高效率，客户端发送一个请求后，SDK异步回调给客户端。但是，有些请求，客户端希望同步，等待回复。这个时候，建立一个map，以req的sequence为key，value为信号量的指针，信号量的容量设置为1，可用的货物为0，对信号量进行TimeoutP操作，货物个数为-1，阻塞在这里。异步回调，收到回复的sequence，根据map找到信号量指针，进行V操作，货物个数为0，通知前面TimeoutP的线程继续执行下去，这个时候，TimeoutP的线程，把回复消息取出来，返回给客户端。
```